---
title: "Structural Equation Modeling in R"
author: "Marlon Schumacher"
date: '2018-10-24'
slug: structural-equation-modeling-in-r
categories:
  - R
  - Tutorial
tags:
  - SEM
  - Structural Equation Modeling
  - lavaan
  - semplot
  - fit indices
image:
  caption: ''
  focal_point: ''
bibliography: bibliography_001.bib 
csl: mcstatistics.csl
output: 
  blogdown::html_page:
    toc: true
---


<div id="TOC">
<ul>
<li><a href="#lavaan-a-package-for-sem">lavaan: A Package for SEM</a></li>
<li><a href="#syntax-for-modelling">Syntax for Modelling</a></li>
<li><a href="#model-fitting">Model Fitting</a></li>
</ul>
</div>

<div id="lavaan-a-package-for-sem" class="section level2">
<h2>lavaan: A Package for SEM</h2>
<p>In my pervious post I made a <a href="https://www.mcstatistics.eu/post/structural-equation-modeling-a-short-introduction/">short introduction to Structural Equation Modeling (SEM)</a>. But now it’s about using R for SEM. However, to use R for SEM we need the package <code>lavaan</code>. For the visualization of the models we also need the package <code>semPlot</code>. As you probably know already the installation of the packages is very simple:</p>
<pre class="r"><code>install.packages(&quot;lavaan&quot;)
install.packages(&quot;semPlot&quot;)</code></pre>
</div>
<div id="syntax-for-modelling" class="section level2">
<h2>Syntax for Modelling</h2>
<p>The modely syntax of lavaan is used for specifying a SEM. There are three operators for model specification:</p>
<ul>
<li><code>=~</code> is used to specify latent variables/factors</li>
<li><code>~~</code> is used to specify (residual) (co)variances</li>
<li><code>~</code> is used to specify rgeression</li>
</ul>
<p>So kann mit diesen Operatoren folgendes Beispielmodell spezfiziert werden:</p>
<pre class="r"><code>example &lt;- &quot;
# measurement model
F1 =~ 1*V1 + V2 + V3
F2 =~ 1*V4 + V5 + V6

# (residual) (co)variances
V1 ~~ V1 # variance
V1 ~~ V3 # residual correlation

# regressions
F1 ~ F2&quot;</code></pre>
</div>
<div id="model-fitting" class="section level2">
<h2>Model Fitting</h2>
<p>Now, let’s specify the first model. I will use an own dataset from a previous work. It’s also possible to use the built-in datasets <code>HolzingerSwineford1939</code> or <code>PolitcialDemocracy</code> from lavaan to become familiar with the package. Moreover, the functions <code>cfa()</code> and <code>sem()</code> are currently similar but they may differ in the future.</p>
<pre class="r"><code>library(lavaan)
model &lt;- &quot;
# measurement model
F1 =~ 1*X1 + X2 + X3 + X4 + X5 + X6
F2 =~ 1*Y1 + Y2 + Y3 + Y4

# regression
F1 ~ F2&quot;

#let&#39;s fit the model
fit &lt;- cfa(model, data = data)

#summary of the fit with standardized values and fit measurements
summary(fit, standardized = T, fit.measures = T)</code></pre>
<pre><code>## lavaan 0.6-3 ended normally after 39 iterations
## 
##   Optimization method                           NLMINB
##   Number of free parameters                         21
## 
##   Number of observations                          1914
## 
##   Estimator                                         ML
##   Model Fit Test Statistic                     218.644
##   Degrees of freedom                                34
##   P-value (Chi-square)                           0.000
## 
## Model test baseline model:
## 
##   Minimum Function Test Statistic             4983.424
##   Degrees of freedom                                45
##   P-value                                        0.000
## 
## User model versus baseline model:
## 
##   Comparative Fit Index (CFI)                    0.963
##   Tucker-Lewis Index (TLI)                       0.951
## 
## Loglikelihood and Information Criteria:
## 
##   Loglikelihood user model (H0)             -39038.962
##   Loglikelihood unrestricted model (H1)     -38929.641
## 
##   Number of free parameters                         21
##   Akaike (AIC)                               78119.925
##   Bayesian (BIC)                             78236.621
##   Sample-size adjusted Bayesian (BIC)        78169.903
## 
## Root Mean Square Error of Approximation:
## 
##   RMSEA                                          0.053
##   90 Percent Confidence Interval          0.047  0.060
##   P-value RMSEA &lt;= 0.05                          0.203
## 
## Standardized Root Mean Square Residual:
## 
##   SRMR                                           0.036
## 
## Parameter Estimates:
## 
##   Information                                 Expected
##   Information saturated (h1) model          Structured
##   Standard Errors                             Standard
## 
## Latent Variables:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all
##   F1 =~                                                                 
##     X1                1.000                               1.197    0.652
##     X2                0.839    0.043   19.375    0.000    1.004    0.541
##     X3                0.857    0.037   23.071    0.000    1.026    0.679
##     X4                1.035    0.046   22.288    0.000    1.239    0.646
##     X5                0.884    0.041   21.644    0.000    1.058    0.621
##     X6                0.916    0.044   20.634    0.000    1.096    0.584
##   F2 =~                                                                 
##     Y1                1.000                               1.413    0.803
##     Y2                6.793    0.244   27.820    0.000    9.597    0.763
##     Y3                1.456    0.067   21.775    0.000    2.057    0.554
##     Y4                0.280    0.012   23.360    0.000    0.395    0.596
## 
## Regressions:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all
##   F1 ~                                                                  
##     F2               -0.228    0.025   -9.151    0.000   -0.270   -0.270
## 
## Variances:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all
##    .X1                1.933    0.077   24.991    0.000    1.933    0.574
##    .X2                2.440    0.088   27.650    0.000    2.440    0.708
##    .X3                1.232    0.051   24.071    0.000    1.232    0.539
##    .X4                2.140    0.085   25.186    0.000    2.140    0.582
##    .X5                1.783    0.069   25.906    0.000    1.783    0.614
##    .X6                2.318    0.086   26.801    0.000    2.318    0.659
##    .Y1                1.101    0.067   16.454    0.000    1.101    0.355
##    .Y2               66.303    3.414   19.423    0.000   66.303    0.419
##    .Y3                9.577    0.347   27.610    0.000    9.577    0.694
##    .Y4                0.284    0.011   26.758    0.000    0.284    0.645
##    .F1                1.328    0.094   14.162    0.000    0.927    0.927
##     F2                1.996    0.109   18.251    0.000    1.000    1.000</code></pre>
</div>
